pip freeze > requirements.txt
pip install -r requirements.txt

# [é¡¹ç›®åç§° - è¯·æ›¿æ¢]

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäº Python çš„å°çº¢ä¹¦ App è‡ªåŠ¨åŒ–å·¥å…·ã€‚å®ƒé€šè¿‡ Flask API æ¥æ”¶ä»»åŠ¡æŒ‡ä»¤ï¼Œä½¿ç”¨ Firebase Firestore ä½œä¸ºä»»åŠ¡é˜Ÿåˆ—å’ŒçŠ¶æ€ç®¡ç†ä¸­å¿ƒï¼Œå¹¶å€ŸåŠ© Appium åœ¨å®‰å“æ¨¡æ‹Ÿå™¨æˆ–çœŸå®è®¾å¤‡ä¸Šæ‰§è¡Œå…·ä½“çš„å°çº¢ä¹¦åº”ç”¨å†…æ“ä½œã€‚

## âœ¨ ä¸»è¦åŠŸèƒ½

* **API é©±åŠ¨çš„ä»»åŠ¡æäº¤**ï¼šé€šè¿‡ RESTful API æ¥å£åˆ›å»ºè‡ªåŠ¨åŒ–ä»»åŠ¡ã€‚
* **çµæ´»çš„ä»»åŠ¡å‚æ•°**ï¼šæ”¯æŒå¦‚â€œæŠ“å–ç¬”è®°â€ (`scrape_note`)ã€â€œæŠ“å–å•†å“â€ (`scrape_product`) ç­‰ä¸åŒç±»å‹çš„è‡ªåŠ¨åŒ–åŠ¨ä½œï¼Œå¹¶å¯æ ¹æ®å…³é”®è¯ã€æ»‘åŠ¨æ¬¡æ•°ã€ç­›é€‰æ¡ä»¶ç­‰å‚æ•°è¿›è¡Œå®šåˆ¶ã€‚
* **Firebase Firestore ä»»åŠ¡é˜Ÿåˆ—**ï¼šåˆ©ç”¨ Firestore å®ç°å¼ºå¤§ã€å®æ—¶çš„ä»»åŠ¡åˆ›å»ºã€åˆ†å‘å’ŒçŠ¶æ€è¿½è¸ªã€‚
* **Appium è‡ªåŠ¨åŒ–æ ¸å¿ƒ**ï¼šç›´æ¥ä¸å®‰å“ç‰ˆå°çº¢ä¹¦ App è¿›è¡Œäº¤äº’ï¼Œæ¨¡æ‹Ÿç”¨æˆ·æ“ä½œã€‚
* **å¼‚æ­¥å¹¶å‘å¤„ç†ä»»åŠ¡**ï¼šèƒ½å¤Ÿç›‘å¬å¹¶å¤„ç†å¤šä¸ªä»»åŠ¡ï¼Œé€šè¿‡å¤šçº¿ç¨‹å¼‚æ­¥æ‰§è¡Œ Appium æ“ä½œï¼ˆå®é™…å¹¶è¡Œåº¦å–å†³äº Appium ç¯å¢ƒé…ç½®ï¼‰ã€‚
* **Pydantic æ•°æ®æ ¡éªŒ**ï¼šç¡®ä¿ API è¯·æ±‚å‚æ•°çš„å‡†ç¡®æ€§å’Œå®Œæ•´æ€§ã€‚

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

ç³»ç»Ÿä¸»è¦ç”±ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒç»„ä»¶æ„æˆï¼š

1.  **Flask API æœåŠ¡ (`api/`)**ï¼š
    * æä¾› HTTP POST æ¥å£ï¼ˆä¾‹å¦‚ `/tasks`ï¼‰ç”¨äºæ¥æ”¶æ–°çš„è‡ªåŠ¨åŒ–ä»»åŠ¡è¯·æ±‚ã€‚
    * ä½¿ç”¨ Pydantic æ¨¡å‹å¯¹è¯·æ±‚æ•°æ®è¿›è¡Œä¸¥æ ¼æ ¡éªŒã€‚
    * éªŒè¯é€šè¿‡åï¼Œå°†ä»»åŠ¡æ•°æ®å†™å…¥ Firebase Firestore çš„ `tasks` é›†åˆï¼Œå¹¶è®¾ç½®åˆå§‹çŠ¶æ€ä¸º `pending`ã€‚
2.  **Firebase ä»»åŠ¡ç›‘å¬å™¨ (`listeners/`)**ï¼š
    * å®æ—¶ç›‘å¬ Firestore ä¸­ `tasks` é›†åˆå†…çŠ¶æ€ä¸º `pending` çš„æ–°ä»»åŠ¡ã€‚
    * ä¸€æ—¦æ£€æµ‹åˆ°æ–°ä»»åŠ¡ï¼Œç«‹å³å°†å…¶çŠ¶æ€æ›´æ–°ä¸º `processing`ã€‚
    * åœ¨æ–°çš„çº¿ç¨‹ä¸­è°ƒç”¨ç›¸åº”çš„æœåŠ¡æ¨¡å—æ¥æ‰§è¡Œå…·ä½“çš„ Appium è‡ªåŠ¨åŒ–è„šæœ¬ã€‚
3.  **Appium è‡ªåŠ¨åŒ–æœåŠ¡ (`services/` åŠ `core/`)**ï¼š
    * `core/driver_manager.py`: è´Ÿè´£ç®¡ç† Appium WebDriver çš„ä¼šè¯ç”Ÿå‘½å‘¨æœŸï¼ˆè¿æ¥ã€å…³é—­ç­‰ï¼‰ã€‚
    * `services/*.py`: åŒ…å«é’ˆå¯¹ä¸åŒä»»åŠ¡ç±»å‹ï¼ˆå¦‚ç¬”è®°æŠ“å–ã€å•†å“æŠ“å–ï¼‰çš„ Appium è‡ªåŠ¨åŒ–æ“ä½œå®ç°é€»è¾‘ã€‚
4.  **Firebase Firestore æ•°æ®åº“**:
    * ä½œä¸ºç³»ç»Ÿçš„ä¸­å¤®ä»»åŠ¡é˜Ÿåˆ—å’Œæ•°æ®å­˜å‚¨ã€‚
    * å­˜å‚¨ä»»åŠ¡çš„è¯¦ç»†å‚æ•°ã€å½“å‰çŠ¶æ€ï¼ˆpending, processing, completed, failedï¼‰ã€æ‰§è¡Œç»“æœæˆ–é”™è¯¯ä¿¡æ¯ã€‚


## ğŸ”§ ç¯å¢ƒå‡†å¤‡

åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿ä½ çš„å¼€å‘ç¯å¢ƒæ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼š

* **Python**: å»ºè®®ä½¿ç”¨ 3.8 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚
* **Node.js å’Œ npm/yarn**: ç”¨äºå®‰è£…å’Œç®¡ç† Appium Serverã€‚
* **Appium Server**: ä¾‹å¦‚ v2.x ç‰ˆæœ¬ã€‚ç¡®ä¿å·²å®‰è£…æ‰€éœ€çš„é©±åŠ¨ (å¦‚ `uiautomator2`)ã€‚
* **Android SDK**: å¹¶å·²å°† `adb` å·¥å…·çš„è·¯å¾„é…ç½®åˆ°ç³»ç»Ÿç¯å¢ƒå˜é‡ `PATH` ä¸­ã€‚
* **å®‰å“æ¨¡æ‹Ÿå™¨æˆ–çœŸå®å®‰å“è®¾å¤‡**:
    * æ¨¡æ‹Ÿå™¨ï¼šæ¨èä½¿ç”¨ Android Studio è‡ªå¸¦çš„æ¨¡æ‹Ÿå™¨ã€‚
    * çœŸå®è®¾å¤‡ï¼šéœ€å¼€å¯â€œå¼€å‘è€…é€‰é¡¹â€å’Œâ€œUSBè°ƒè¯•â€åŠŸèƒ½ã€‚
* **Java JDK**: Appium å’Œ Android SDK å·¥å…·å¯èƒ½éœ€è¦ã€‚
* **Firebase é¡¹ç›®**:
    * å·²åˆ›å»ºä¸€ä¸ª Firebase é¡¹ç›®ã€‚
    * åœ¨é¡¹ç›®ä¸­å¯ç”¨äº† Firestore æ•°æ®åº“ã€‚
* **å°çº¢ä¹¦ App**: å·²åœ¨ç›®æ ‡æ¨¡æ‹Ÿå™¨/è®¾å¤‡ä¸Šå®‰è£…ã€‚

## âš™ï¸ å®‰è£…ä¸é…ç½®

1.  **å…‹éš†ä»£ç åº“**:
    ```bash
    git clone <ä½ çš„ä»£ç åº“URL>
    cd <é¡¹ç›®ç›®å½•>
    ```

2.  **åˆ›å»ºå¹¶æ¿€æ´» Python è™šæ‹Ÿç¯å¢ƒ**:
    ```bash
    python -m venv venv
    # Windows
    venv\Scripts\activate
    # macOS/Linux
    source venv/bin/activate
    ```

3.  **å®‰è£… Python ä¾èµ–**:
    (è¯·ç¡®ä¿ `requirements.txt` æ–‡ä»¶åŒ…å«æ‰€æœ‰å¿…è¦çš„åº“)
    ```bash
    pip install -r requirements.txt
    ```
    *ä¸»è¦ä¾èµ–å¯èƒ½åŒ…æ‹¬:*
    ```
    Flask
    pydantic
    firebase-admin
    Appium-Python-Client
    # å…¶ä»–ä½ é¡¹ç›®ä¸­ç”¨åˆ°çš„åº“
    ```

4.  **é…ç½® Firebase Admin SDK**:
    * ç™»å½• Firebase æ§åˆ¶å°ã€‚
    * è¿›å…¥ä½ çš„é¡¹ç›®ï¼Œå¯¼èˆªåˆ°â€œé¡¹ç›®è®¾ç½®â€ > â€œæœåŠ¡å¸å·â€ã€‚
    * ç”Ÿæˆæ–°çš„ç§é’¥ï¼Œä¸‹è½½å¯¹åº”çš„ JSON æ–‡ä»¶ã€‚
    * å°†ä¸‹è½½çš„ JSON æ–‡ä»¶é‡å‘½åä¸º `firebase-service-account-key.json` å¹¶æ”¾ç½®åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹ã€‚

5.  **é…ç½® Appium åŠå®‰å“ç¯å¢ƒ**:
    * **å®‰è£… Appium Server**:
        ```bash
        npm install -g appium # æˆ–è€… yarn global add appium
        # å®‰è£…uiautomator2é©±åŠ¨ (ç”¨äºå®‰å“è‡ªåŠ¨åŒ–)
        appium driver install uiautomator2
        ```
    * **å¯åŠ¨å¹¶é…ç½®å®‰å“æ¨¡æ‹Ÿå™¨/è®¾å¤‡**:
        * é€šè¿‡ Android Studio å¯åŠ¨æˆ–åˆ›å»ºæ¨¡æ‹Ÿå™¨ã€‚
        * æˆ–è¿æ¥å·²å¯ç”¨USBè°ƒè¯•çš„çœŸå®å®‰å“è®¾å¤‡ã€‚
        * åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œ `adb devices`ï¼Œç¡®ä¿ä½ çš„è®¾å¤‡/æ¨¡æ‹Ÿå™¨è¢«æ­£ç¡®åˆ—å‡ºä¸”çŠ¶æ€ä¸º `device`ã€‚
    * **Appium Capabilities é…ç½®**:
        æ‰“å¼€ `core/driver_manager.py` æ–‡ä»¶ã€‚ä½ å¯èƒ½éœ€è¦æ ¹æ®ä½ çš„å…·ä½“ç¯å¢ƒä¿®æ”¹ Appium çš„ Desired Capabilitiesï¼Œä¾‹å¦‚ï¼š
        ```python
        DESIRED_CAPABILITIES = {
            'platformName': 'Android',
            'appium:platformVersion': '12.0', # æ›¿æ¢ä¸ºä½ çš„å®‰å“ç‰ˆæœ¬
            'appium:deviceName': '127.0.0.1:7555', # æ›¿æ¢ä¸ºä½ çš„ adb device ID (æ¨¡æ‹Ÿå™¨é€šå¸¸æ˜¯ emulator-xxxx æˆ– IP:Port)
            'appium:automationName': 'UiAutomator2',
            'appium:appPackage': 'com.xingin.xhs', # å°çº¢ä¹¦çš„åŒ…å
            'appium:appActivity': '.index.v2.IndexActivityV2', # å°çº¢ä¹¦çš„å¯åŠ¨Activity
            'appium:noReset': True, # True è¡¨ç¤ºä¸é‡ç½®åº”ç”¨çŠ¶æ€
            # ... å…¶ä»–ä½ éœ€è¦çš„ capabilities
        }
        ```
        **æ³¨æ„**: `appPackage` å’Œ `appActivity` å¯èƒ½å› å°çº¢ä¹¦ç‰ˆæœ¬æ›´æ–°è€Œæ”¹å˜ï¼Œè¯·ç¡®è®¤å…¶å‡†ç¡®æ€§ã€‚

## â–¶ï¸ è¿è¡Œåº”ç”¨

è¯·æŒ‰ç…§ä»¥ä¸‹æ¨èé¡ºåºå¯åŠ¨å„ä¸ªç»„ä»¶ï¼š

1.  **å¯åŠ¨ Appium Server**:
    æ‰“å¼€ä¸€ä¸ªæ–°çš„ç»ˆç«¯çª—å£ï¼Œè¾“å…¥ `appium` å‘½ä»¤å¯åŠ¨ Appium Serverã€‚è¯·ç•™æ„å…¶ç›‘å¬çš„åœ°å€å’Œç«¯å£ï¼ˆé»˜è®¤ä¸º `http://127.0.0.1:4723`ï¼‰ã€‚

2.  **å¯åŠ¨å¹¶å‡†å¤‡å®‰å“æ¨¡æ‹Ÿå™¨/è®¾å¤‡**:
    ç¡®ä¿ä½ çš„å®‰å“æ¨¡æ‹Ÿå™¨å·²å¯åŠ¨å¹¶è¿è¡Œï¼Œæˆ–çœŸå®è®¾å¤‡å·²é€šè¿‡ USB è¿æ¥å¹¶æˆæƒè°ƒè¯•ã€‚è®¾å¤‡éœ€èƒ½è¢« `adb devices` å‘½ä»¤æ£€æµ‹åˆ°ã€‚

3.  **å¯åŠ¨ Firebase ä»»åŠ¡ç›‘å¬å™¨**:
    åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼Œæ‰“å¼€ä¸€ä¸ªæ–°çš„ç»ˆç«¯çª—å£ï¼ˆå·²æ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼‰ï¼Œè¿è¡Œï¼š
    ```bash
    python listeners/firebase_task_listener.py
    ```
    ä½ åº”è¯¥ä¼šçœ‹åˆ°ç±»ä¼¼ "æ­£åœ¨ç›‘å¬ Firestore..." çš„æ—¥å¿—ã€‚

4.  **å¯åŠ¨ Flask API æœåŠ¡**:
    åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼Œå†æ‰“å¼€ä¸€ä¸ªæ–°çš„ç»ˆç«¯çª—å£ï¼ˆå·²æ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼‰ï¼Œè¿è¡Œï¼š
    ```bash
    python -m api.app
    ```
    API æœåŠ¡é»˜è®¤ä¼šåœ¨ `http://127.0.0.1:5000` ä¸Šè¿è¡Œã€‚

## ğŸš€ ä½¿ç”¨è¯´æ˜ (APIè°ƒç”¨ç¤ºä¾‹)

ä½ å¯ä»¥ä½¿ç”¨ `curl` æˆ– Postman ç­‰å·¥å…·å‘ Flask API å‘é€ POST è¯·æ±‚æ¥åˆ›å»ºä»»åŠ¡ã€‚

**è¯·æ±‚å¤´**: `Content-Type: application/json`

**è¯·æ±‚åœ°å€**: `http://127.0.0.1:5000/tasks`

**1. åˆ›å»º "æŠ“å–ç¬”è®°" (`scrape_note`) ä»»åŠ¡**

* **è¯·æ±‚ä½“ (JSON)**:
    ```json
    {
        "actions": "scrape_note",
        "parameters": {
            "keyword": "ç¾é£Ÿæ•™ç¨‹",
            "swipe_count": 5,
            "filters": {
                "category": "çƒ¹é¥ª"
            }
        }
    }
    ```
* **curl ç¤ºä¾‹ (Windows cmd)**:
    ```cmd
    curl -X POST -H "Content-Type: application/json" -d "{\"actions\":\"scrape_note\",\"parameters\":{\"keyword\":\"ç¾é£Ÿæ•™ç¨‹\",\"swipe_count\":5,\"filters\":{\"category\":\"çƒ¹é¥ª\"}}}" [http://127.0.0.1:5000/tasks](http://127.0.0.1:5000/tasks)
    ```
* **curl ç¤ºä¾‹ (PowerShell æˆ– macOS/Linux)**:
    ```bash
    curl -X POST -H "Content-Type: application/json" -d '{"actions":"scrape_note","parameters":{"keyword":"ç¾é£Ÿæ•™ç¨‹","swipe_count":5,"filters":{"category":"çƒ¹é¥ª"}}}' [http://127.0.0.1:5000/tasks](http://127.0.0.1:5000/tasks)
    ```

**2. åˆ›å»º "æŠ“å–å•†å“" (`scrape_product`) ä»»åŠ¡**

* **è¯·æ±‚ä½“ (JSON)**:
    ```json
    {
        "actions": "scrape_product",
        "parameters": {
            "keyword": "è“ç‰™è€³æœº",
            "swipe_count": 3
        }
    }
    ```
* **curl ç¤ºä¾‹ (PowerShell æˆ– macOS/Linux)**:
    ```bash
    curl -X POST -H "Content-Type: application/json" -d '{"actions":"scrape_product","parameters":{"keyword":"è“ç‰™è€³æœº","swipe_count":3}}' [http://127.0.0.1:5000/tasks](http://127.0.0.1:5000/tasks)
    ```

**æˆåŠŸå“åº”ç¤ºä¾‹ (HTTP 201 Created)**:
```json
{
  "message": "ä»»åŠ¡åˆ›å»ºæˆåŠŸ",
  "taskId": "ç”Ÿæˆçš„ä»»åŠ¡ID"
}